<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../contestify-card/index.html">
<link rel="import" href="../contestify-new-contest/index.html">

<dom-module id='contestify-feed'>
  <template>
    <style>
      :host ::content #container {
        @apply(--layout-horizontal);
        @apply(--layout-around-justified);
        @apply(--layout-wrap);
        @apply(--layout-start);
      }

      :host ::content #fabAdd {
        @apply(--shadow-elevation-6dp);
        position: fixed;
        right: 30px;
        bottom: 30px;
      }
    </style>
    <iron-ajax
      id='publicContestList'
      auto
      method='GET'
      url="/publicContestList"
      handle-as="json"
      on-response=onPublicContestListReceived
      debounce-duration="300">
    </iron-ajax>

    <div id='container'>
      <template is='dom-repeat' items='{{currentGames}}'>
        <contestify-card
          match-id=[[item._id.$oid]]
          match-title='[[item.title]]'
          match-description='[[item.description]]'
          match-format='[[item.format]]'
          match-game='[[item.game]]'
          match-total='[[item.totalPlayers]]'
          match-current='5'>
        </contestify-card>
      </template>
    </div>
    <paper-fab id='fabAdd' icon='add' elevation=5 on-tap=toggleNewContestForm></paper-fab>
    <contestify-new-contest is-hidden={{isNewContestFormHidden}} new-contest={{newContest}}>
  </template>
<script>
  Polymer({
    is: 'contestify-feed',
    properties: {
      currentGames: {
        type: Array,
        value: []
      },
      isNewContestFormHidden: {
        type: Boolean,
        value: true,
        notify: true,
        observer: 'onNewContestFormChanged'
      },
      newContest: {
        type: Object,
        notify: true,
        observer: 'onNewContestCreated'
      }
    },
    ready: function () {
    },
    toggleNewContestForm: function () {
      this.set('isNewContestFormHidden', !this.isNewContestFormHidden);
    },
    onPublicContestListReceived: function (res) {
      this.set('currentGames', res.detail.response.result);
    },
    onNewContestFormChanged: function () {
      if (this.isNewContestFormHidden) {
        this.$.fabAdd.setAttribute('icon', 'add');
      }
      else {
        this.$.fabAdd.setAttribute('icon', 'clear');
      }
    },
    onNewContestCreated: function () {
      this.push('currentGames', this.newContest);
    }
  });
</script>

</dom-module>
